-- ROBLOX ITALO LIBRARY AJUSTADA PARA PC

local OrionLib = {}
OrionLib.Flags = {}
OrionLib.Themes = {
    Default = {
        Main = Color3.fromRGB(30,30,30),
        Second = Color3.fromRGB(45,45,45)
    }
}
OrionLib.SelectedTheme = "Default"

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

-- Função auxiliar para criar elementos
local function Create(class, props, children)
    local inst = Instance.new(class)
    if props then
        for k,v in pairs(props) do
            inst[k] = v
        end
    end
    if children then
        for _,c in pairs(children) do
            c.Parent = inst
        end
    end
    return inst
end

-- Função auxiliar de conexão
local function AddConnection(signal, func)
    return signal:Connect(func)
end

-- Função de salvar configuração (placeholder)
local function SaveCfg(gameId)
    -- Aqui você pode implementar salvamento
end

-- FUNÇÃO PRINCIPAL DE CRIAÇÃO DE ELEMENTOS
function OrionLib:CreateTab(TabConfig)
    local Container = Create("Frame", {Size = UDim2.new(1,0,1,0)})
    
    local TabFunction = {}
    
    function TabFunction:AddSection(SectionConfig)
        SectionConfig.Name = SectionConfig.Name or "Section"
        local SectionFrame = Create("Frame", {
            Size = UDim2.new(1,0,0,26),
            Parent = Container
        })
        local Holder = Create("Frame", {
            Size = UDim2.new(1,0,1,0),
            Parent = SectionFrame,
            Name = "Holder"
        })
        local SectionFunction = {}
        return SectionFunction
    end

    function TabFunction:AddDropdown(DropdownConfig)
        local Dropdown = {Value = DropdownConfig.Default or "", Buttons = {}, Toggled = false}
        local DropdownFrame = Create("Frame", {Size = UDim2.new(1,0,0,38), Parent = Container})
        local Click = Create("TextButton", {Size = UDim2.new(1,0,1,0), Text = "", BackgroundTransparency = 1, Active = true})
        Click.Parent = DropdownFrame
        
        -- Garantir todos os botões clicáveis
        DropdownFrame.Active = true
        Click.Active = true
        Click.AutoButtonColor = false
        
        -- Ajustar clique do mouse
        AddConnection(Click.MouseButton1Click, function()
            Dropdown.Toggled = not Dropdown.Toggled
            -- Aqui a animação de abrir dropdown
        end)
        
        Dropdown.Set = function(self, Value)
            self.Value = Value
            -- Atualizar seleção
        end
        
        return Dropdown
    end

    function TabFunction:AddBind(BindConfig)
        local Bind = {Value = BindConfig.Default or Enum.KeyCode.Unknown, Binding = false}
        local BindFrame = Create("Frame", {Size = UDim2.new(1,0,0,38), Parent = Container})
        local Click = Create("TextButton", {Size = UDim2.new(1,0,1,0), Text = "", BackgroundTransparency = 1, Active = true})
        Click.Parent = BindFrame
        
        -- Input PC
        AddConnection(UserInputService.InputBegan, function(Input)
            if UserInputService:GetFocusedTextBox() then return end
            if Bind.Binding then
                Bind.Value = Input.KeyCode.Name or Bind.Value
                Bind.Binding = false
            end
        end)
        
        return Bind
    end

    function TabFunction:AddTextbox(TextboxConfig)
        local TextboxFrame = Create("Frame", {Size = UDim2.new(1,0,0,38), Parent = Container})
        local TextboxActual = Create("TextBox", {
            Size = UDim2.new(1,0,1,0),
            BackgroundTransparency = 1,
            TextColor3 = Color3.fromRGB(255,255,255),
            PlaceholderText = "[Input]",
            Font = Enum.Font.GothamSemibold,
            TextXAlignment = Enum.TextXAlignment.Center,
            TextSize = 14,
            ClearTextOnFocus = false,
            Active = true
        })
        TextboxActual.Parent = TextboxFrame
        
        local Click = Create("TextButton", {Size = UDim2.new(1,0,1,0), Text="", BackgroundTransparency=1, Active=true})
        Click.Parent = TextboxFrame
        
        -- Garantir clique PC
        Click.Active = true
        Click.AutoButtonColor = false
        
        AddConnection(TextboxActual.FocusLost, function()
            if TextboxConfig.Callback then
                TextboxConfig.Callback(TextboxActual.Text)
            end
        end)
    end

    function TabFunction:AddColorpicker(ColorpickerConfig)
        local Colorpicker = {Value = ColorpickerConfig.Default or Color3.fromRGB(255,255,255), Toggled = false}
        local ColorpickerFrame = Create("Frame", {Size = UDim2.new(1,0,0,38), Parent = Container})
        local Click = Create("TextButton", {Size = UDim2.new(1,0,1,0), Text="", BackgroundTransparency=1, Active=true})
        Click.Parent = ColorpickerFrame
        
        -- Garantir clique PC
        Click.Active = true
        Click.AutoButtonColor = false
        
        -- Toggle do colorpicker
        AddConnection(Click.MouseButton1Click, function()
            Colorpicker.Toggled = not Colorpicker.Toggled
            -- Mostrar/ocultar seleção de cores
        end)
        
        Colorpicker.Set = function(self, Value)
            self.Value = Value
            if ColorpickerConfig.Callback then
                ColorpickerConfig.Callback(Value)
            end
        end
        
        return Colorpicker
    end
    
    return TabFunction
end

function OrionLib:Destroy()
    -- Destroy UI
end

return OrionLib
